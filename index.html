<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>„Éñ„É©„ÉÉ„ÇØ„Ç∏„É£„ÉÉ„ÇØ - ÁàÜÁô∫Èü≥‰ªò„Åç</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, sans-serif;
      background: #0a5f1a;
      color: white;
      text-align: center;
      padding: 20px;
      line-height: 1.5;
    }
    .card {
      display: inline-block;
      width: 80px;
      height: 120px;
      background: white;
      color: black;
      border-radius: 8px;
      margin: 5px;
      padding: 8px;
      font-size: 24px;
      font-weight: bold;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
      position: relative;
    }
    .card-top {
      position: absolute;
      top: 5px;
      left: 8px;
      font-size: 20px;
    }
    .card-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 40px;
      line-height: 1;
    }
    .card-bottom {
      position: absolute;
      bottom: 5px;
      right: 8px;
      font-size: 20px;
      transform: rotate(180deg);
    }
    .red { color: #e74c3c; }
    .black { color: #2c3e50; }
    .hidden-card {
      background: #333;
      color: transparent;
      border: 2px solid #555;
    }
    .hidden-card::after {
      content: "?";
      color: white;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 40px;
      color: rgba(255,255,255,0.7);
    }
    .area {
      background: rgba(0,0,0,0.3);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
    }
    .score {
      font-size: 24px;
      margin: 10px 0;
      font-weight: bold;
    }
    .controls {
      margin: 25px;
    }
    button {
      font-size: 18px;
      padding: 12px 24px;
      margin: 0 10px;
      border: none;
      border-radius: 8px;
      background: #3498db;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:hover { background: #2980b9; transform: translateY(-2px); }
    button:active { transform: translateY(1px); }
    #stand { background: #e74c3c; }
    #stand:hover { background: #c0392b; }
    #new-game { background: #2ecc71; }
    #new-game:hover { background: #27ae60; }
    .message {
      font-size: 26px;
      margin: 25px;
      min-height: 40px;
      padding: 15px;
      border-radius: 10px;
      background: rgba(0,0,0,0.4);
      font-weight: bold;
    }
    .win { background: rgba(241, 196, 15, 0.8); color: #2c3e50; }
    .lose { background: rgba(231, 76, 60, 0.8); }
    .draw { background: rgba(149, 165, 166, 0.8); }
    .explode { 
      animation: explodeAnim 0.5s; 
      background: radial-gradient(circle, rgba(231,76,60,0.9) 0%, rgba(192,57,43,0.9) 70%, rgba(140,40,30,0.9) 100%);
    }
    @keyframes explodeAnim {
      0% { transform: scale(1); box-shadow: 0 0 0px rgba(255,0,0,0); }
      50% { transform: scale(1.2); box-shadow: 0 0 50px rgba(255,0,0,0.8); }
      100% { transform: scale(1); box-shadow: 0 0 0px rgba(255,0,0,0); }
    }
    h1 {
      font-size: 36px;
      margin: 20px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
      color: #f1c40f;
      text-align: center;
    }
    .sound-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      border: 2px solid white;
      color: white;
      font-size: 24px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>‚ô† BLACKJACK ‚ô•</h1>

  <div class="area">
    <h2>ü§ñ „Éá„Ç£„Éº„É©„Éº</h2>
    <div id="dealer-cards" style="min-height: 140px; margin: 15px 0;"></div>
    <div class="score">SCORE: <span id="dealer-score">?</span></div>
  </div>

  <div class="message" id="message"></div>

  <div class="area">
    <h2>üë§ „Éó„É¨„Ç§„É§„Éº</h2>
    <div id="player-cards" style="min-height: 140px; margin: 15px 0;"></div>
    <div class="score">SCORE: <span id="player-score">0</span></div>
  </div>

  <div class="controls">
    <button id="hit">‚ûï „Éí„ÉÉ„Éà</button>
    <button id="stand">‚úã „Çπ„Çø„É≥„Éâ</button>
    <button id="new-game">üîÑ Êñ∞Ë¶è„Ç≤„Éº„É†</button>
  </div>

  <div class="sound-btn" id="sound-toggle">üîä</div>

  <script>
    // „Çµ„Ç¶„É≥„Éâ„Éû„Éç„Éº„Ç∏„É£„ÉºÔºàÁàÜÁô∫Èü≥‰ªò„ÅçÔºâ
    class SoundManager {
      constructor() {
        this.ctx = null;
        this.muted = false;
        try {
          window.AudioContext = window.AudioContext || window.webkitAudioContext;
          this.ctx = new AudioContext();
        } catch(e) {}
      }
      
      play(freq, dur=0.1, type='sine', vol=0.2) {
        if (this.muted || !this.ctx) return;
        if (this.ctx.state === 'suspended') this.ctx.resume();
        const o = this.ctx.createOscillator();
        const g = this.ctx.createGain();
        o.type = type;
        o.frequency.value = freq;
        g.gain.value = vol;
        o.connect(g);
        g.connect(this.ctx.destination);
        o.start();
        o.stop(this.ctx.currentTime + dur);
      }
      
      // „Ç´„Éº„Éâ„ÇíÂºï„ÅèÈü≥
      card() { 
        this.play(440, 0.1, 'triangle', 0.2); 
        setTimeout(() => this.play(660, 0.1, 'triangle', 0.2), 50); 
      }
      
      // „ÇØ„É™„ÉÉ„ÇØÈü≥
      click() { 
        this.play(330, 0.05, 'sine', 0.3); 
      }
      
      // ÂãùÂà©Èü≥
      win() { 
        [523, 659, 784].forEach((f,i) => 
          setTimeout(() => this.play(f, 0.2, 'sine', 0.4), i * 150)
        ); 
      }
      
      // üí• ÁàÜÁô∫Èü≥ÔºàÊïóÂåóÊôÇÔºâ
      explode() {
        if (this.muted || !this.ctx) return;
        if (this.ctx.state === 'suspended') this.ctx.resume();
        
        // ÁàÜÁô∫„ÅÆ‰ΩéÈü≥ÔºàË§áÊï∞„ÅÆ‰Ωé„ÅÑÂë®Ê≥¢Êï∞Ôºâ
        const explodeFreqs = [100, 80, 120, 60, 90];
        const explodeDurs = [0.06, 0.05, 0.07, 0.04, 0.06];
        const explodeVols = [0.7, 0.6, 0.8, 0.5, 0.7];
        
        explodeFreqs.forEach((freq, i) => {
          setTimeout(() => {
            this.play(freq, explodeDurs[i], 'square', explodeVols[i]);
          }, i * 25);
        });
        
        // ÁÅ´Ëä±„ÉªÁ†¥Áâá„ÅÆÈ´òÈü≥
        setTimeout(() => {
          this.play(880, 0.04, 'sine', 0.3);
          setTimeout(() => this.play(1320, 0.03, 'sine', 0.2), 40);
          setTimeout(() => this.play(1760, 0.02, 'sine', 0.15), 80);
        }, 130);
      }
      
      // „Éâ„É≠„ÉºÈü≥
      draw() { 
        this.play(440, 0.15, 'square', 0.3); 
        setTimeout(() => this.play(440, 0.15, 'square', 0.3), 200); 
      }
      
      // „Ç≤„Éº„É†ÈñãÂßãÈü≥
      start() {
        [330, 440, 554].forEach((f,i) => 
          setTimeout(() => this.play(f, 0.15, 'sine', 0.4), i * 150)
        );
      }
      
      toggle() { 
        this.muted = !this.muted; 
        return this.muted; 
      }
    }

    // „Ç≤„Éº„É†Ë®≠ÂÆö
    const suits = [
      { sym: '‚ô†', col: 'black' },
      { sym: '‚ô•', col: 'red' },
      { sym: '‚ô¶', col: 'red' },
      { sym: '‚ô£', col: 'black' }
    ];
    const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
    let deck = [], player = [], dealer = [], active = false;
    const sound = new SoundManager();

    // „Éá„ÉÉ„Ç≠‰ΩúÊàê
    function createDeck() {
      const d = [];
      suits.forEach(s => ranks.forEach(r => d.push({s:s.sym,c:s.col,r:r})));
      return d;
    }

    // „Ç∑„É£„ÉÉ„Éï„É´
    function shuffle(a) {
      for (let i=a.length-1; i>0; i--) {
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
    }

    // „Çπ„Ç≥„Ç¢Ë®àÁÆó
    function score(hand) {
      let s=0, a=0;
      hand.forEach(c => {
        if (c.r==='A') { s+=11; a++; }
        else if (['J','Q','K'].includes(c.r)) s+=10;
        else s+=parseInt(c.r);
      });
      while(s>21 && a>0) { s-=10; a--; }
      return s;
    }

    // „Ç´„Éº„ÉâË°®Á§∫
    function renderCard(c, hidden=false) {
      const div = document.createElement('div');
      if (hidden) {
        div.className = 'card hidden-card';
        return div;
      }
      div.className = 'card';
      div.innerHTML = `
        <div class="card-top ${c.c}">${c.r}<br>${c.s}</div>
        <div class="card-center ${c.c}">${c.s}</div>
        <div class="card-bottom ${c.c}">${c.r}<br>${c.s}</div>
      `;
      return div;
    }

    // ÊâãÊú≠Ë°®Á§∫
    function render() {
      const pc = document.getElementById('player-cards');
      const dc = document.getElementById('dealer-cards');
      pc.innerHTML = ''; dc.innerHTML = '';
      
      player.forEach(c => pc.appendChild(renderCard(c)));
      dealer.forEach((c,i) => dc.appendChild(renderCard(c, !active && i===1)));
      
      document.getElementById('player-score').textContent = score(player);
      document.getElementById('dealer-score').textContent = active ? score(dealer) : '?';
    }

    // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
    function msg(text, cls='') {
      const m = document.getElementById('message');
      m.textContent = text;
      m.className = 'message ' + cls;
    }

    // „Éñ„É©„ÉÉ„ÇØ„Ç∏„É£„ÉÉ„ÇØ„ÉÅ„Çß„ÉÉ„ÇØ
    function checkBJ() {
      const ps = score(player), ds = score(dealer);
      if (ps===21 && ds===21) { 
        msg('üé≠ „Éâ„É≠„ÉºÔºÅ‰∏°ËÄÖ„Éñ„É©„ÉÉ„ÇØ„Ç∏„É£„ÉÉ„ÇØÔºÅ', 'draw'); 
        sound.draw(); 
        active=false; 
        return true; 
      }
      if (ps===21) { 
        msg('üéâ „Éñ„É©„ÉÉ„ÇØ„Ç∏„É£„ÉÉ„ÇØÔºÅ„ÅÇ„Å™„Åü„ÅÆÂãù„Å°ÔºÅ', 'win'); 
        sound.win(); 
        active=false; 
        return true; 
      }
      if (ds===21) { 
        msg('üí• „Éá„Ç£„Éº„É©„Éº„Åå„Éñ„É©„ÉÉ„ÇØ„Ç∏„É£„ÉÉ„ÇØÔºÅÁàÜÁô∫ÔºÅ', 'lose explode'); 
        sound.explode(); 
        active=false; 
        return true; 
      }
      return false;
    }

    // „Ç≤„Éº„É†ÁµÇ‰∫Ü
    function end() {
      active = false;
      render(); // ÂÖ®„Ç´„Éº„ÉâË°®Á§∫
      const ps = score(player), ds = score(dealer);
      
      if (ps>21) { 
        msg('üí• „Éê„Éº„Çπ„ÉàÔºÅÁàÜÁô∫ÔºÅ„ÅÇ„Å™„Åü„ÅÆË≤†„ÅëÔºÅ', 'lose explode'); 
        sound.explode(); 
      }
      else if (ds>21) { 
        msg('üéä „Éá„Ç£„Éº„É©„Éº„Åå„Éê„Éº„Çπ„ÉàÔºÅ„ÅÇ„Å™„Åü„ÅÆÂãù„Å°ÔºÅ', 'win'); 
        sound.win(); 
      }
      else if (ps>ds) { 
        msg(`üèÜ „ÅÇ„Å™„Åü„ÅÆÂãù„Å°ÔºÅ (${ps} vs ${ds})`, 'win'); 
        sound.win(); 
      }
      else if (ps<ds) { 
        msg(`üí• „ÅÇ„Å™„Åü„ÅÆË≤†„ÅëÔºÅÁàÜÁô∫ÔºÅ (${ps} vs ${ds})`, 'lose explode'); 
        sound.explode(); 
      }
      else { 
        msg(`ü§ù „Éâ„É≠„Éº (${ps} vs ${ds})`, 'draw'); 
        sound.draw(); 
      }
    }

    // „Éá„Ç£„Éº„É©„Éº„ÅÆ„Çø„Éº„É≥
    function dealerTurn() {
      render();
      if (score(dealer) < 17) {
        sound.card();
        dealer.push(deck.pop());
        setTimeout(dealerTurn, 600);
      } else {
        setTimeout(end, 800);
      }
    }

    // „Ç≤„Éº„É†ÈñãÂßã
    function start() {
      deck = createDeck();
      shuffle(deck);
      player = [deck.pop(), deck.pop()];
      dealer = [deck.pop(), deck.pop()];
      active = true;
      msg('');
      render();
      
      sound.start();
      
      if (!checkBJ()) {
        // „Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥
      }
    }

    // „Ç§„Éô„É≥„ÉàË®≠ÂÆö
    document.getElementById('hit').onclick = () => {
      if (!active) return;
      sound.click(); sound.card();
      player.push(deck.pop());
      render();
      if (score(player) >= 21) setTimeout(() => { 
        if(score(player)===21) { 
          msg('üéØ 21ÔºÅ„Éë„Éº„Éï„Çß„ÇØ„ÉàÔºÅ', 'win'); 
          sound.win(); 
        }
        end(); 
      }, 300);
    };

    document.getElementById('stand').onclick = () => {
      if (!active) return;
      sound.click();
      msg('ü§î „Éá„Ç£„Éº„É©„Éº„ÅÆ„Çø„Éº„É≥...');
      active = false;
      setTimeout(dealerTurn, 800);
    };

    document.getElementById('new-game').onclick = () => {
      sound.click();
      start();
    };

    document.getElementById('sound-toggle').onclick = () => {
      const m = sound.toggle();
      document.getElementById('sound-toggle').textContent = m ? 'üîá' : 'üîä';
      if (!m) sound.play(440, 0.1, 'sine', 0.2);
    };

    // „Ç≠„Éº„Éú„Éº„ÉâÊìç‰Ωú
    document.onkeydown = (e) => {
      if (!active) return;
      if (e.key==='h'||e.key==='H') document.getElementById('hit').click();
      else if (e.key==='s'||e.key==='S') document.getElementById('stand').click();
    };

    // ÂàùÊúüÂåñ
    window.onload = () => {
      // „ÇØ„É™„ÉÉ„ÇØ„ÅßAudioContext„ÇíÊúâÂäπÂåñ
      document.body.onclick = () => {
        if (sound.ctx && sound.ctx.state==='suspended') sound.ctx.resume();
        document.body.onclick = null;
      };
      setTimeout(start, 300);
    };
  </script>
</body>
</html>